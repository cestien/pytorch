<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/default.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">
<link rel="stylesheet" href="file:////home/cestien/.vscode/extensions/goessner.mdmath-2.7.4/themes/default/style.css">

</head>
<body class="markdown-body">
<div  dir="auto" ></div>
<link href="/home/cestien/memoria/template/nota_template/miestilo.css" rel="stylesheet"></link>
<h1 dir="auto" id="notas-antes-de-incluirlas-en-notasmd">Notas antes de incluirlas en <code>notas.md</code></h1>
<h2 dir="auto" id="main">Main</h2>
<pre><code class="code-line language-python" dir="auto">    <span class="hljs-comment"># Dataset IO prep: creating Dataset objects and proper encodings for phones</span>
    train_data, valid_data, test_data = dataio_prep(hparams)

    <span class="hljs-comment"># Trainer initialization</span>
    asr_brain = ASR_Brain(
        modules=hparams[<span class="hljs-string">&quot;modules&quot;</span>],
        opt_class=hparams[<span class="hljs-string">&quot;opt_class&quot;</span>],
        hparams=hparams,
        run_opts=run_opts,
        checkpointer=hparams[<span class="hljs-string">&quot;checkpointer&quot;</span>],
    )
    
    <span class="hljs-comment"># Training/validation loop</span>
    asr_brain.fit(
        asr_brain.hparams.epoch_counter,
        train_data,
        valid_data,
        train_loader_kwargs=hparams[<span class="hljs-string">&quot;train_dataloader_opts&quot;</span>],
        valid_loader_kwargs=hparams[<span class="hljs-string">&quot;valid_dataloader_opts&quot;</span>],
    )

    <span class="hljs-comment"># Test</span>
    asr_brain.evaluate(
        test_data,
        min_key=<span class="hljs-string">&quot;PER&quot;</span>,
        test_loader_kwargs=hparams[<span class="hljs-string">&quot;test_dataloader_opts&quot;</span>],
    )

</code></pre>
<h2 dir="auto" id="que-cosas-tiene-cada-m%C3%A9todo">Que cosas tiene cada método</h2>
<pre><code class="code-line language-python" dir="auto">fit():
    make_dataloader()
    on_fit_start()
    _fit_train()

</code></pre>
<h2 dir="auto" id="datio_prepare-simplificado"><code>datio_prepare</code> simplificado</h2>
<pre><code class="code-line language-python" dir="auto"><span class="hljs-keyword">def</span> <span class="hljs-title function_">dataio_prep</span>(<span class="hljs-params">hparams</span>):
    <span class="hljs-comment"># Crea los datasets</span>
    train_data = sb.dataio.dataset.DynamicItemDataset.from_json(json_path)
    valid_data = sb.dataio.dataset.DynamicItemDataset.from_json(json_path)
    test_data = sb.dataio.dataset.DynamicItemDataset.from_json(json_path)
    <span class="hljs-comment"># Los ordenamos por duración (default sin ordernar)</span>
    train_data = train_data.filtered_sorted(sort_key=<span class="hljs-string">&quot;duration&quot;</span>)
    valid_data = valid_data.filtered_sorted(sort_key=<span class="hljs-string">&quot;duration&quot;</span>)
    test_data = test_data.filtered_sorted(sort_key=<span class="hljs-string">&quot;duration&quot;</span>)
    datasets = [train_data, valid_data, test_data]
    <span class="hljs-comment"># Pipeline de los wav</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">audio_pipeline</span>(<span class="hljs-params">wav</span>):
        sig = sb.dataio.dataio.read_audio(wav)
        <span class="hljs-keyword">return</span> sig
    sb.dataio.dataset.add_dynamic_item(datasets, audio_pipeline)
    <span class="hljs-comment"># Pipeline de los labels</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">text_pipeline</span>(<span class="hljs-params">phn</span>):
        phn_list = phn.strip().split()
        <span class="hljs-keyword">yield</span> phn_list
        phn_encoded = sb.dataio.encoder.CTCTextEncoder().encode_sequence_torch(phn_list)
        <span class="hljs-keyword">yield</span> phn_encoded
    sb.dataio.dataset.add_dynamic_item(datasets, text_pipeline)
    <span class="hljs-keyword">return</span> train_data, valid_data, test_data

</code></pre>

</body>
</html>